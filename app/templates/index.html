{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block head %}
    {{ super() }}
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1"></script>
{% endblock %}

{% block sidebar %}
<div class="sidebar-header">
    <h3>CAN Config</h3>
    <button id="close-sidebar-btn" class="close-btn">&times;</button>
</div>
<form id="config-form">
    <div class="form-group">
        <label for="rx_id">RX ID</label>
        <input type="text" id="rx_id" name="rx_id" value="{{ config.get('rx_id', '0x123') }}">
    </div>
    <div class="form-group">
        <label for="tx_id">TX ID</label>
        <input type="text" id="tx_id" name="tx_id" value="{{ config.get('tx_id', '0x456') }}">
    </div>
    <div class="form-group">
        <label for="baud_rate">Baud Rate</label>
        <input type="text" id="baud_rate" name="baud_rate" value="{{ config.get('baud_rate', '500000') }}">
    </div>
    <div class="form-group">
        <label for="no_of_tyres">Number of Tyres</label>
        <input type="number" id="no_of_tyres" name="no_of_tyres" min="1" value="{{ config.get('no_of_tyres', 6) }}">
    </div>
    <div class="form-group">
        <label for="tire_config">Tire Configuration per Axle</label>
        <input type="text" id="tire_config" name="tire_config" placeholder="e.g., 2,4" value="2,4">
        <small style="color: #999; font-size: 12px; margin-top: 5px; display: block;">Enter tires per axle separated by commas (e.g., 2,4 for a 6-wheel truck)</small>
    </div>
    <button type="submit" class="btn-config">Configure</button>
</form>
   


{% endblock %}

{% block content %}
<div class="container">
    <div class="tyre-display-section">
        <div class="tyre-display-header">
            <h3>Tyre Positions</h3>
            <div class="view-switcher">
                <button id="data-view-btn" class="view-btn active">Data View</button>
                <button id="2d-view-btn" class="view-btn">2D View</button>
            </div>
        </div>
        <!-- Data View Container -->
        <div id="data-view-container" class="view-content active">
            <div id="tyre-positions-container" class="tyre-container">
                <!-- Tyre positions will be generated by JavaScript -->
            </div>
        </div>
        <!-- 2D Truck View Container -->
        <div id="truck-2d-container" class="view-content">
            <div class="truck-container-wrapper">
                <div class="truck-2d-view" id="truck-2d-view">
                    <div class="truck-body-container">
                        <div class="truck-body">
                            <div class="truck-cab"></div>
                            <div class="truck-trailer"></div>
                        </div>
                    </div>
                    <!-- Tires will be dynamically positioned here -->
                </div>
            </div>
        </div>
    </div>

    <div class="graph-section">
        <div class="graph-header">
            <h3>Graphs</h3>
            <div>
                <button id="reset-zoom-btn" class="btn-secondary">Reset Zoom</button>
                <div class="dropdown">
                    <button class="dropbtn">Select Graph &#9662;</button>
                    <div class="dropdown-content">
                        <a href="#" data-graph="pressure">Pressure</a>
                        <a href="#" data-graph="temperature">Temperature</a>
                        <a href="#" data-graph="battery">Battery</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="graph-container">
            <canvas id="main-chart"></canvas>
        </div>
    </div>

    <div class="table-section">
        <h3>Live Data</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Tyre</th>
                    <th>Pressure (PSI)</th>
                    <th>Temperature (Â°C)</th>
                    <th>Battery (%)</th>
                </tr>
            </thead>
            <tbody id="live-data-body">
                <!-- Data rows will be generated by JavaScript -->
            </tbody>
        </table>
    </div>
</div>

<!-- Tire Detail Modal for 2D View -->
<div id="tire-2d-detail-modal" class="tpms-modal">
    <div class="tpms-modal-content tire-detail-modal-content">
        <div class="tire-detail-header">
            <h2 id="tire-2d-detail-title">ğŸš› Tire Details</h2>
            <button class="close-tire-detail-btn" id="close-tire-detail-x" title="Close">&times;</button>
        </div>
        
        <!-- Live Data Cards -->
        <div class="tire-detail-cards">
            <div class="data-card pressure-card">
                <div class="card-icon">ğŸ“Š</div>
                <div class="card-label">Pressure</div>
                <div class="card-value" id="detail-2d-pressure">0.0</div>
                <div class="card-unit">PSI</div>
            </div>
            <div class="data-card temperature-card">
                <div class="card-icon">ğŸŒ¡ï¸</div>
                <div class="card-label">Temperature</div>
                <div class="card-value" id="detail-2d-temperature">0.0</div>
                <div class="card-unit">Â°C</div>
            </div>
            <div class="data-card battery-card">
                <div class="card-icon">ğŸ”‹</div>
                <div class="card-label">Battery</div>
                <div class="card-value" id="detail-2d-battery">0</div>
                <div class="card-unit">%</div>
            </div>
        </div>

        <!-- Individual Tire Graph -->
        <div class="tire-detail-graph-section">
            <div class="graph-controls-header">
                <h3>ğŸ“ˆ Live Data Graph</h3>
                <div class="view-selector">
                    <button class="arrow-btn" id="prev-view-2d" title="Previous View">â—€</button>
                    <select id="tire-2d-detail-view-selector" class="view-selector-dropdown">
                        <option value="pressure">Pressure</option>
                        <option value="temperature">Temperature</option>
                        <option value="battery">Battery</option>
                    </select>
                    <button class="arrow-btn" id="next-view-2d" title="Next View">â–¶</button>
                </div>
            </div>
            <div class="zoom-controls">
                <button class="zoom-btn" id="zoom-in-2d" title="Zoom In">ğŸ”+</button>
                <button class="zoom-btn" id="zoom-out-2d" title="Zoom Out">ğŸ”-</button>
                <button class="zoom-btn" id="zoom-reset-2d" title="Reset Zoom">â†º Reset</button>
            </div>
            <div class="tire-detail-graph-container">
                <canvas id="tire-2d-detail-chart"></canvas>
            </div>
        </div>
    </div>
</div>

{% endblock %}